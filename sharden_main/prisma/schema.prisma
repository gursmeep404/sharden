generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id    Int     @id @default(autoincrement())
  name  String  @unique @db.VarChar(50)
  users Users[]

  @@map("roles")
}

model Users {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email         String    @unique @db.VarChar(255)
  password_hash String
  name          String?   @db.VarChar(100)
  role_id       Int
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @updatedAt @db.Timestamptz(6)
  role          Role      @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("users")
}

model BankData {
  id            Int       @id @default(autoincrement())
  userId        String    @map("user_id") @db.Uuid
  name          String
  email         String
  password      String
  accountNumber String    @unique @map("account_number") @db.VarChar(20)
  panNumber     String    @unique @map("pan_number") @db.VarChar(10)
  cardNumber    String    @unique @map("card_number") @db.VarChar(19)
  spendLimit    Decimal?  @default(0) @map("spend_limit") @db.Decimal(12, 2)
  balance       Decimal   @default(0) @db.Decimal(12, 2)
  phoneNumber   String?   @map("phone_number") @db.VarChar(15)
  securityId    String?   @map("security_id")
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)

  @@map("bank_data")
}

model fileauditlog {
  id         BigInt     @id @default(autoincrement())
  fileid     BigInt
  action     String     @db.VarChar(100)
  status     String     @db.VarChar(50)
  details    String?
  timestamp  DateTime?  @default(now()) @db.Timestamp(6)
  file       String?    @db.VarChar(255)
  securefile securefile @relation(fields: [fileid], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model securefile {
  id                BigInt         @id @default(autoincrement())
  original_filename String         @db.VarChar(255)
  storage_path      String         @db.VarChar(500)
  mime_type         String         @db.VarChar(100)
  senderemail       String         @db.VarChar(255)
  recipientemail    String         @db.VarChar(255)
  expirytime        DateTime       @db.Timestamp(6)
  revoked           Boolean?       @default(false)
  e2e               Boolean?       @default(false)
  iv_b64            String?
  encrypted_size    BigInt?
  createdat         DateTime?      @default(now()) @db.Timestamp(6)
  updatedat         DateTime?      @default(now()) @db.Timestamp(6)
  fileauditlog      fileauditlog[]
}
